#!/bin/bash
# Admin stuff
#SBATCH -J KHARMA
#SBATCH -t 2:00:00
#SBATCH -N 1
#SBATCH -o "out-%j.txt"

# Partition
#SBATCH -p gpu_debug --reservation gpu_debug --qos debug
##SBATCH -p gpu

# Nodes we want
#SBATCH --tasks-per-node=4
# TODO 80GB specific?

# Node options
# Note we could do 32 if HT is faster
#SBATCH --cpus-per-task=16
# ALWAYS reserve full nodes to mitigate memory leaks
#SBATCH --exclusive
#SBATCH --mem=0

# LANL Chicoma run script

# KHARMA directory
KHARMA_DIR="$HOME/Code/kharma-multizone"

# OpenMP directives: use all available threads
# TODO Chicoma doesn't allocate correctly
#export OMP_PROC_BIND=spread
#export OMP_PLACES=threads

# Load any defaults/modules from the machine file
HOST=ch-fe1.lanl.gov
ARGS=$(cat $KHARMA_DIR/make_args)
source $KHARMA_DIR/machines/lanl.sh

# Run with srun
# TODO auto-switch to mpirun in interactive?
./run.sh -t 11:55:00 "$@"
