#!/bin/bash

# Submit/run script for KHARMA.  Work in progress
#SBATCH -J kharma

# flat-quadrant, normal
#SBATCH -p flat-quadrant

#SBATCH -N 1
#SBATCH --ntasks-per-node 1

#SBATCH -t 48:00:00
#SBATCH -o out-%j.txt

export OMP_PROC_BIND=spread
export OMP_PLACES=threads

# Schedule 2x hyperthreads on SXK or KNL. More on KNL *might* be useful      
NUM_CPUS=$(grep ^cpu\\scores /proc/cpuinfo | uniq |  awk '{print $4}')
export OMP_NUM_THREADS=$(( $NUM_CPUS * 2 ))
ibrun ./kharma.host "$@"
